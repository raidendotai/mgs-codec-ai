"use strict";var Si=Object.create;var vt=Object.defineProperty;var xi=Object.getOwnPropertyDescriptor;var Pi=Object.getOwnPropertyNames;var Ti=Object.getPrototypeOf,Ai=Object.prototype.hasOwnProperty;var en=r=>{throw TypeError(r)};var H=(r,e)=>()=>(r&&(e=r(r=0)),e);var Oe=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports),de=(r,e)=>{for(var t in e)vt(r,t,{get:e[t],enumerable:!0})},tn=(r,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of Pi(e))!Ai.call(r,i)&&i!==t&&vt(r,i,{get:()=>e[i],enumerable:!(n=xi(e,i))||n.enumerable});return r};var _=(r,e,t)=>(t=r!=null?Si(Ti(r)):{},tn(e||!r||!r.__esModule?vt(t,"default",{value:r,enumerable:!0}):t,r)),Ei=r=>tn(vt({},"__esModule",{value:!0}),r);var nr=(r,e,t)=>e.has(r)||en("Cannot "+t);var a=(r,e,t)=>(nr(r,e,"read from private field"),t?t.call(r):e.get(r)),y=(r,e,t)=>e.has(r)?en("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(r):e.set(r,t),f=(r,e,t,n)=>(nr(r,e,"write to private field"),n?n.call(r,t):e.set(r,t),t),u=(r,e,t)=>(nr(r,e,"access private method"),t);var me=(r,e,t,n)=>({set _(i){f(r,e,i,t)},get _(){return a(r,e,n)}});var Fi,w,d=H(()=>{"use strict";Fi=()=>typeof document>"u"?new URL(`file:${__filename}`).href:document.currentScript&&document.currentScript.src||new URL("main.js",document.baseURI).href,w=Fi()});var W,Ve=H(()=>{"use strict";d();W=class{constructor(e){this.dataDir=e}async syncToFs(e,t){}async initialSyncFs(e){}async close(e){}}});var Qe=Oe((Ja,U)=>{"use strict";d();var sn=9007199254740991,an=function(r){return r}();function vi(r){return r===an}function on(r){return typeof r=="string"||Object.prototype.toString.call(r)=="[object String]"}function Mi(r){return Object.prototype.toString.call(r)=="[object Date]"}function Mt(r){return r!==null&&typeof r=="object"}function Nt(r){return typeof r=="function"}function Ni(r){return typeof r=="number"&&r>-1&&r%1==0&&r<=sn}function Ri(r){return Object.prototype.toString.call(r)=="[object Array]"}function cn(r){return Mt(r)&&!Nt(r)&&Ni(r.length)}function sr(r){return Object.prototype.toString.call(r)=="[object ArrayBuffer]"}function _i(r,e){return Array.prototype.map.call(r,e)}function Bi(r,e){var t=an;return Nt(e)&&Array.prototype.every.call(r,function(n,i,s){var o=e(n,i,s);return o&&(t=n),!o}),t}function ki(r){return Object.assign.apply(null,arguments)}function ln(r){var e,t,n;if(on(r)){for(t=r.length,n=new Uint8Array(t),e=0;e<t;e++)n[e]=r.charCodeAt(e)&255;return n}return sr(r)?new Uint8Array(r):Mt(r)&&sr(r.buffer)?new Uint8Array(r.buffer):cn(r)?new Uint8Array(r):Mt(r)&&Nt(r.toString)?ln(r.toString()):new Uint8Array}U.exports.MAX_SAFE_INTEGER=sn;U.exports.isUndefined=vi;U.exports.isString=on;U.exports.isObject=Mt;U.exports.isDateTime=Mi;U.exports.isFunction=Nt;U.exports.isArray=Ri;U.exports.isArrayLike=cn;U.exports.isArrayBuffer=sr;U.exports.map=_i;U.exports.find=Bi;U.exports.extend=ki;U.exports.toUint8Array=ln});var $e=Oe((eo,un)=>{"use strict";d();var ar="\0";un.exports={NULL_CHAR:ar,TMAGIC:"ustar"+ar+"00",OLDGNU_MAGIC:"ustar  "+ar,REGTYPE:0,LNKTYPE:1,SYMTYPE:2,CHRTYPE:3,BLKTYPE:4,DIRTYPE:5,FIFOTYPE:6,CONTTYPE:7,TSUID:parseInt("4000",8),TSGID:parseInt("2000",8),TSVTX:parseInt("1000",8),TUREAD:parseInt("0400",8),TUWRITE:parseInt("0200",8),TUEXEC:parseInt("0100",8),TGREAD:parseInt("0040",8),TGWRITE:parseInt("0020",8),TGEXEC:parseInt("0010",8),TOREAD:parseInt("0004",8),TOWRITE:parseInt("0002",8),TOEXEC:parseInt("0001",8),TPERMALL:parseInt("0777",8),TPERMMASK:parseInt("0777",8)}});var lr=Oe((ro,L)=>{"use strict";d();var pn=Qe(),F=$e(),Ci=512,or=F.TPERMALL,dn=0,mn=0,cr=[["name",100,0,function(r,e){return Ye(r[e[0]],e[1])},function(r,e,t){return fe(r.slice(e,e+t[1]))}],["mode",8,100,function(r,e){var t=r[e[0]]||or;return t=t&F.TPERMMASK,Ie(t,e[1],or)},function(r,e,t){var n=X(r.slice(e,e+t[1]));return n&=F.TPERMMASK,n}],["uid",8,108,function(r,e){return Ie(r[e[0]],e[1],dn)},function(r,e,t){return X(r.slice(e,e+t[1]))}],["gid",8,116,function(r,e){return Ie(r[e[0]],e[1],mn)},function(r,e,t){return X(r.slice(e,e+t[1]))}],["size",12,124,function(r,e){return Ie(r.data.length,e[1])},function(r,e,t){return X(r.slice(e,e+t[1]))}],["modifyTime",12,136,function(r,e){return Rt(r[e[0]],e[1])},function(r,e,t){return _t(r.slice(e,e+t[1]))}],["checksum",8,148,function(r,e){return"        "},function(r,e,t){return X(r.slice(e,e+t[1]))}],["type",1,156,function(r,e){return""+(parseInt(r[e[0]],10)||0)%8},function(r,e,t){return(parseInt(String.fromCharCode(r[e]),10)||0)%8}],["linkName",100,157,function(r,e){return""},function(r,e,t){return fe(r.slice(e,e+t[1]))}],["ustar",8,257,function(r,e){return F.TMAGIC},function(r,e,t){return Ui(fe(r.slice(e,e+t[1]),!0))},function(r,e){return r[e[0]]==F.TMAGIC||r[e[0]]==F.OLDGNU_MAGIC}],["owner",32,265,function(r,e){return Ye(r[e[0]],e[1])},function(r,e,t){return fe(r.slice(e,e+t[1]))}],["group",32,297,function(r,e){return Ye(r[e[0]],e[1])},function(r,e,t){return fe(r.slice(e,e+t[1]))}],["majorNumber",8,329,function(r,e){return""},function(r,e,t){return X(r.slice(e,e+t[1]))}],["minorNumber",8,337,function(r,e){return""},function(r,e,t){return X(r.slice(e,e+t[1]))}],["prefix",131,345,function(r,e){return Ye(r[e[0]],e[1])},function(r,e,t){return fe(r.slice(e,e+t[1]))}],["accessTime",12,476,function(r,e){return Rt(r[e[0]],e[1])},function(r,e,t){return _t(r.slice(e,e+t[1]))}],["createTime",12,488,function(r,e){return Rt(r[e[0]],e[1])},function(r,e,t){return _t(r.slice(e,e+t[1]))}]],fn=function(r){var e=r[r.length-1];return e[2]+e[1]}(cr);function Ui(r){if(r.length==8){var e=r.split("");if(e[5]==F.NULL_CHAR)return(e[6]==" "||e[6]==F.NULL_CHAR)&&(e[6]="0"),(e[7]==" "||e[7]==F.NULL_CHAR)&&(e[7]="0"),e=e.join(""),e==F.TMAGIC?e:r;if(e[7]==F.NULL_CHAR)return e[5]==F.NULL_CHAR&&(e[5]=" "),e[6]==F.NULL_CHAR&&(e[6]=" "),e==F.OLDGNU_MAGIC?e:r}return r}function Ye(r,e){return e-=1,pn.isUndefined(r)&&(r=""),r=(""+r).substr(0,e),r+F.NULL_CHAR}function Ie(r,e,t){for(t=parseInt(t)||0,e-=1,r=(parseInt(r)||t).toString(8).substr(-e,e);r.length<e;)r="0"+r;return r+F.NULL_CHAR}function Rt(r,e){if(pn.isDateTime(r))r=Math.floor(1*r/1e3);else if(r=parseInt(r,10),isFinite(r)){if(r<=0)return""}else r=Math.floor(1*new Date/1e3);return Ie(r,e,0)}function fe(r,e){var t=String.fromCharCode.apply(null,r);if(e)return t;var n=t.indexOf(F.NULL_CHAR);return n>=0?t.substr(0,n):t}function X(r){var e=String.fromCharCode.apply(null,r);return parseInt(e.replace(/^0+$/g,""),8)||0}function _t(r){return r.length==0||r[0]==0?null:new Date(1e3*X(r))}function Li(r,e,t){var n=parseInt(e,10)||0,i=Math.min(n+fn,r.length),s=0,o=0,c=0;t&&cr.every(function(g){return g[0]=="checksum"?(o=n+g[2],c=o+g[1],!1):!0});for(var l=32,p=n;p<i;p++){var m=p>=o&&p<c?l:r[p];s=(s+m)%262144}return s}L.exports.recordSize=Ci;L.exports.defaultFileMode=or;L.exports.defaultUid=dn;L.exports.defaultGid=mn;L.exports.posixHeader=cr;L.exports.effectiveHeaderSize=fn;L.exports.calculateChecksum=Li;L.exports.formatTarString=Ye;L.exports.formatTarNumber=Ie;L.exports.formatTarDateTime=Rt;L.exports.parseTarString=fe;L.exports.parseTarNumber=X;L.exports.parseTarDateTime=_t});var bn=Oe((io,gn)=>{"use strict";d();var zi=$e(),Bt=Qe(),ne=lr();function yn(r){return ne.recordSize}function hn(r){return Math.ceil(r.data.length/ne.recordSize)*ne.recordSize}function Gi(r){var e=0;return r.forEach(function(t){e+=yn(t)+hn(t)}),e+=ne.recordSize*2,new Uint8Array(e)}function ji(r,e,t){t=parseInt(t)||0;var n=t;ne.posixHeader.forEach(function(l){for(var p=l[3](e,l),m=p.length,g=0;g<m;g+=1)r[n+g]=p.charCodeAt(g)&255;n+=l[1]});var i=Bt.find(ne.posixHeader,function(l){return l[0]=="checksum"});if(i){var s=ne.calculateChecksum(r,t,!0),o=ne.formatTarNumber(s,i[1]-2)+zi.NULL_CHAR+" ";n=t+i[2];for(var c=0;c<o.length;c+=1)r[n]=o.charCodeAt(c)&255,n++}return t+yn(e)}function Hi(r,e,t){return t=parseInt(t,10)||0,r.set(e.data,t),t+hn(e)}function qi(r){r=Bt.map(r,function(n){return Bt.extend({},n,{data:Bt.toUint8Array(n.data)})});var e=Gi(r),t=0;return r.forEach(function(n){t=ji(e,n,t),t=Hi(e,n,t)}),e}gn.exports.tar=qi});var Sn=Oe((ao,wn)=>{"use strict";d();var Wi=$e(),pr=Qe(),V=lr(),Vi={extractData:!0,checkHeader:!0,checkChecksum:!0,checkFileSize:!0},Qi={size:!0,checksum:!0,ustar:!0},ur={unexpectedEndOfFile:"Unexpected end of file.",fileCorrupted:"File is corrupted.",checksumCheckFailed:"Checksum check failed."};function $i(r){return V.recordSize}function Yi(r){return Math.ceil(r/V.recordSize)*V.recordSize}function Ki(r,e){for(var t=e,n=Math.min(r.length,e+V.recordSize*2),i=t;i<n;i++)if(r[i]!=0)return!1;return!0}function Xi(r,e,t){if(r.length-e<V.recordSize){if(t.checkFileSize)throw new Error(ur.unexpectedEndOfFile);return null}e=parseInt(e)||0;var n={},i=e;if(V.posixHeader.forEach(function(c){n[c[0]]=c[4](r,i,c),i+=c[1]}),n.type!=0&&(n.size=0),t.checkHeader&&V.posixHeader.forEach(function(c){if(pr.isFunction(c[5])&&!c[5](n,c)){var l=new Error(ur.fileCorrupted);throw l.data={offset:e+c[2],field:c[0]},l}}),t.checkChecksum){var s=V.calculateChecksum(r,e,!0);if(s!=n.checksum){var o=new Error(ur.checksumCheckFailed);throw o.data={offset:e,header:n,checksum:s},o}}return n}function Ji(r,e,t,n){return n.extractData?t.size<=0?new Uint8Array:r.slice(e,e+t.size):null}function Zi(r,e){var t={};return V.posixHeader.forEach(function(n){var i=n[0];Qi[i]||(t[i]=r[i])}),t.isOldGNUFormat=r.ustar==Wi.OLDGNU_MAGIC,e&&(t.data=e),t}function es(r,e){e=pr.extend({},Vi,e);for(var t=[],n=0,i=r.length;i-n>=V.recordSize;){r=pr.toUint8Array(r);var s=Xi(r,n,e);if(!s)break;n+=$i(s);var o=Ji(r,n,s,e);if(t.push(Zi(s,o)),n+=Yi(s.size),Ki(r,n))break}return t}wn.exports.untar=es});var dr=Oe((co,xn)=>{"use strict";d();var ts=Qe(),rs=$e(),ns=bn(),is=Sn();ts.extend(xn.exports,ns,is,rs)});async function ie(r,e,t="auto"){let n=os(r,B),[i,s]=await cs(n,t),o=(e||"pgdata")+(s?".tar.gz":".tar"),c=s?"application/x-gzip":"application/x-tar";return typeof File<"u"?new File([i],o,{type:c}):new Blob([i],{type:c})}async function Tn(r,e){let t=new Uint8Array(await e.arrayBuffer()),n=typeof File<"u"&&e instanceof File?e.name:void 0;(ss.includes(e.type)||n?.endsWith(".tgz")||n?.endsWith(".tar.gz"))&&(t=await ps(t));let s=(0,Q.untar)(t);for(let o of s){let c=B+o.name,l=c.split("/").slice(0,-1);for(let p=1;p<=l.length;p++){let m=l.slice(0,p).join("/");r.analyzePath(m).exists||r.mkdir(m)}o.type===Q.REGTYPE?(r.writeFile(c,o.data),r.utime(c,Pn(o.modifyTime),Pn(o.modifyTime))):o.type===Q.DIRTYPE&&r.mkdir(c)}}function as(r,e){let t=[],n=i=>{r.readdir(i).forEach(o=>{if(o==="."||o==="..")return;let c=i+"/"+o,l=r.stat(c),p=r.isFile(l.mode)?r.readFile(c,{encoding:"binary"}):new Uint8Array(0);t.push({name:c.substring(e.length),mode:l.mode,size:l.size,type:r.isFile(l.mode)?Q.REGTYPE:Q.DIRTYPE,modifyTime:l.mtime,data:p}),r.isDir(l.mode)&&n(c)})};return n(e),t}function os(r,e){let t=as(r,e);return(0,Q.tar)(t)}async function cs(r,e="auto"){if(e==="none")return[r,!1];if(typeof CompressionStream<"u")return[await ls(r),!0];if(typeof process<"u"&&process.versions&&process.versions.node)return[await us(r),!0];if(e==="auto")return[r,!1];throw new Error("Compression not supported in this environment")}async function ls(r){let e=new CompressionStream("gzip"),t=e.writable.getWriter(),n=e.readable.getReader();t.write(r),t.close();let i=[];for(;;){let{value:c,done:l}=await n.read();if(l)break;c&&i.push(c)}let s=new Uint8Array(i.reduce((c,l)=>c+l.length,0)),o=0;return i.forEach(c=>{s.set(c,o),o+=c.length}),s}async function us(r){let{promisify:e}=await import("util"),{gzip:t}=await import("zlib");return await e(t)(r)}async function ps(r){if(typeof CompressionStream<"u")return await ds(r);if(typeof process<"u"&&process.versions&&process.versions.node)return await ms(r);throw new Error("Unsupported environment for decompression")}async function ds(r){let e=new DecompressionStream("gzip"),t=e.writable.getWriter(),n=e.readable.getReader();t.write(r),t.close();let i=[];for(;;){let{value:c,done:l}=await n.read();if(l)break;c&&i.push(c)}let s=new Uint8Array(i.reduce((c,l)=>c+l.length,0)),o=0;return i.forEach(c=>{s.set(c,o),o+=c.length}),s}async function ms(r){let{promisify:e}=await import("util"),{gunzip:t}=await import("zlib");return await e(t)(r)}function Pn(r){return r?typeof r=="number"?r:Math.floor(r.getTime()/1e3):Math.floor(Date.now()/1e3)}var Q,ss,ve=H(()=>{"use strict";d();Q=_(dr(),1);ye();ss=["application/x-gtar","application/x-tar+gzip","application/x-gzip","application/gzip"]});var Me,mr=H(()=>{"use strict";d();Ve();ye();ve();Me=class extends W{async emscriptenOpts(e){return{...e,preRun:[...e.preRun||[],n=>{let i=n.FS.filesystems.IDBFS;n.FS.mkdir("/pglite"),n.FS.mkdir(`/pglite/${this.dataDir}`),n.FS.mount(i,{},`/pglite/${this.dataDir}`),n.FS.symlink(`/pglite/${this.dataDir}`,B)}]}}initialSyncFs(e){return new Promise((t,n)=>{e.syncfs(!0,i=>{i?n(i):t()})})}syncToFs(e,t){return new Promise((n,i)=>{e.syncfs(!1,s=>{s?i(s):n()})})}async dumpTar(e,t,n){return ie(e,t,n)}async close(e){let t=e.filesystems.IDBFS.dbs[this.dataDir];t&&t.close(),e.quit()}}});var Ne,fr=H(()=>{"use strict";d();Ve();ve();Ne=class extends W{async emscriptenOpts(e){return e}async dumpTar(e,t,n){return ie(e,t,n)}async close(e){e.quit()}}});var An={};de(An,{NodeFS:()=>yr});var kt,Ct,yr,En=H(()=>{"use strict";d();kt=_(require("fs"),1),Ct=_(require("path"),1);Ve();ye();ve();yr=class extends W{constructor(e){super(e),this.rootDir=Ct.resolve(e),kt.existsSync(Ct.join(this.rootDir))||kt.mkdirSync(this.rootDir)}async emscriptenOpts(e){return{...e,preRun:[...e.preRun||[],n=>{let i=n.FS.filesystems.NODEFS;n.FS.mkdir(B),n.FS.mount(i,{root:this.rootDir},B)}]}}async dumpTar(e,t,n){return ie(e,t,n)}async close(e){e.quit()}}});var Ut,A,hr=H(()=>{"use strict";d();Ut={EBADF:8,EBADFD:127,EEXIST:20,EINVAL:28,EISDIR:31,ENODEV:43,ENOENT:44,ENOTDIR:54,ENOTEMPTY:55},A=class extends Error{constructor(e,t){super(t),typeof e=="number"?this.code=e:typeof e=="string"&&(this.code=Ut[e])}}});function E(...r){}var Fn,Dn=H(()=>{"use strict";d();hr();Fn=(r,e)=>{let t=r.FS,n={tryFSOperation(i){try{return i()}catch(s){throw s.code?s.code==="UNKNOWN"?new t.ErrnoError(Ut.EINVAL):new t.ErrnoError(s.code):s}},mount(i){return n.createNode(null,"/",16895,0)},syncfs(i,s,o){},createNode(i,s,o,c){if(!t.isDir(o)&&!t.isFile(o))throw new t.ErrnoError(28);let l=t.createNode(i,s,o);return l.node_ops=n.node_ops,l.stream_ops=n.stream_ops,l},getMode:function(i){return E("getMode",i),n.tryFSOperation(()=>e.lstat(i).mode)},realPath:function(i){let s=[];for(;i.parent!==i;)s.push(i.name),i=i.parent;return s.push(i.mount.opts.root),s.reverse(),s.join("/")},node_ops:{getattr(i){E("getattr",n.realPath(i));let s=n.realPath(i);return n.tryFSOperation(()=>{let o=e.lstat(s);return{...o,dev:0,ino:i.id,nlink:1,rdev:i.rdev,atime:new Date(o.atime),mtime:new Date(o.mtime),ctime:new Date(o.ctime)}})},setattr(i,s){E("setattr",n.realPath(i),s);let o=n.realPath(i);n.tryFSOperation(()=>{s.mode!==void 0&&e.chmod(o,s.mode),s.size!==void 0&&e.truncate(o,s.size),s.timestamp!==void 0&&e.utimes(o,s.timestamp,s.timestamp),s.size!==void 0&&e.truncate(o,s.size)})},lookup(i,s){E("lookup",n.realPath(i),s);let o=[n.realPath(i),s].join("/"),c=n.getMode(o);return n.createNode(i,s,c)},mknod(i,s,o,c){E("mknod",n.realPath(i),s,o,c);let l=n.createNode(i,s,o,c),p=n.realPath(l);return n.tryFSOperation(()=>(t.isDir(l.mode)?e.mkdir(p,{mode:o}):e.writeFile(p,"",{mode:o}),l))},rename(i,s,o){E("rename",n.realPath(i),n.realPath(s),o);let c=n.realPath(i),l=[n.realPath(s),o].join("/");n.tryFSOperation(()=>{e.rename(c,l)}),i.name=o},unlink(i,s){E("unlink",n.realPath(i),s);let o=[n.realPath(i),s].join("/");try{e.unlink(o)}catch{}},rmdir(i,s){E("rmdir",n.realPath(i),s);let o=[n.realPath(i),s].join("/");return n.tryFSOperation(()=>{e.rmdir(o)})},readdir(i){E("readdir",n.realPath(i));let s=n.realPath(i);return n.tryFSOperation(()=>e.readdir(s))},symlink(i,s,o){throw E("symlink",n.realPath(i),s,o),new t.ErrnoError(63)},readlink(i){throw E("readlink",n.realPath(i)),new t.ErrnoError(63)}},stream_ops:{open(i){E("open stream",n.realPath(i.node));let s=n.realPath(i.node);return n.tryFSOperation(()=>{t.isFile(i.node.mode)&&(i.shared.refcount=1,i.nfd=e.open(s))})},close(i){return E("close stream",n.realPath(i.node)),n.tryFSOperation(()=>{t.isFile(i.node.mode)&&i.nfd&&--i.shared.refcount===0&&e.close(i.nfd)})},dup(i){E("dup stream",n.realPath(i.node)),i.shared.refcount++},read(i,s,o,c,l){return E("read stream",n.realPath(i.node),o,c,l),c===0?0:n.tryFSOperation(()=>e.read(i.nfd,s,o,c,l))},write(i,s,o,c,l){return E("write stream",n.realPath(i.node),o,c,l),n.tryFSOperation(()=>e.write(i.nfd,s.buffer,o,c,l))},llseek(i,s,o){E("llseek stream",n.realPath(i.node),s,o);let c=s;if(o===1?c+=i.position:o===2&&t.isFile(i.node.mode)&&n.tryFSOperation(()=>{let l=e.fstat(i.nfd);c+=l.size}),c<0)throw new t.ErrnoError(28);return c},mmap(i,s,o,c,l){if(E("mmap stream",n.realPath(i.node),s,o,c,l),!t.isFile(i.node.mode))throw new t.ErrnoError(Ut.ENODEV);let p=r.mmapAlloc(s);return n.stream_ops.read(i,r.HEAP8,p,s,o),{ptr:p,allocated:!0}},msync(i,s,o,c,l){return E("msync stream",n.realPath(i.node),o,c,l),n.stream_ops.write(i,s,0,c,o),0}}};return n}});var fs,ys,gr,Xe,Je,_e,ge,Ze,D,J,N,et,se,ae,Y,h,On,he,Re,$,M,Ke,In,br,wr,Lt,vn=H(()=>{"use strict";d();hr();fs="state.txt",ys="data",gr={DIR:16384,FILE:32768},wr=class wr{constructor({root:e,initialPoolSize:t,maintainedPoolSize:n}){y(this,h);y(this,Xe,!1);y(this,Je);y(this,_e);y(this,ge);y(this,Ze);y(this,D);y(this,J,new Map);y(this,N,new Map);y(this,et,0);y(this,se,new Map);y(this,ae,new Map);this.lastCheckpoint=0;this.checkpointInterval=1e3*60;this.poolCounter=0;y(this,Y,new Set);this.root=e,this.initialPoolSize=t||1e3,this.maintainedPoolSize=n||100,this.readyPromise=u(this,h,On).call(this)}static async create(e){let t=new wr(e);return await t.readyPromise,t}get ready(){return a(this,Xe)}async maintainPool(e){e=e||this.maintainedPoolSize;let t=e-this.state.pool.length,n=[];for(let i=0;i<t;i++)n.push(new Promise(async s=>{++this.poolCounter;let o=`${(Date.now()-1704063600).toString(16).padStart(8,"0")}-${this.poolCounter.toString(16).padStart(8,"0")}`,c=await a(this,ge).getFileHandle(o,{create:!0}),l=await c.createSyncAccessHandle();a(this,J).set(o,c),a(this,N).set(o,l),u(this,h,Re).call(this,{opp:"createPoolFile",args:[o]}),this.state.pool.push(o),s()}));for(let i=0;i>t;i--)n.push(new Promise(async s=>{let o=this.state.pool.pop();u(this,h,Re).call(this,{opp:"deletePoolFile",args:[o]});let c=a(this,J).get(o);a(this,N).get(o)?.close(),await c.remove().then(()=>{a(this,J).delete(o),a(this,N).delete(o),s()})}));await Promise.all(n)}_createPoolFileState(e){this.state.pool.push(e)}_deletePoolFileState(e){let t=this.state.pool.indexOf(e);t>-1&&this.state.pool.splice(t,1)}async maybeCheckpointState(){Date.now()-this.lastCheckpoint>this.checkpointInterval&&await this.checkpointState()}async checkpointState(){let e=new TextEncoder().encode(JSON.stringify(this.state));a(this,D).truncate(0),a(this,D).write(e,{at:0}),a(this,D).flush(),this.lastCheckpoint=Date.now()}flush(){for(let e of a(this,Y))try{e.flush()}catch{}a(this,Y).clear()}exit(){for(let e of a(this,N).values())e.close();a(this,D).flush(),a(this,D).close()}chmod(e,t){u(this,h,he).call(this,{opp:"chmod",args:[e,t]},()=>{this._chmodState(e,t)})}_chmodState(e,t){let n=u(this,h,M).call(this,e);n.mode=t}close(e){let t=u(this,h,Ke).call(this,e);a(this,se).delete(e),a(this,ae).delete(t)}fstat(e){let t=u(this,h,Ke).call(this,e);return this.lstat(t)}lstat(e){let t=u(this,h,M).call(this,e),n=t.type==="file"?a(this,N).get(t.backingFilename).getSize():0,i=4096;return{dev:0,ino:0,mode:t.mode,nlink:1,uid:0,gid:0,rdev:0,size:n,blksize:i,blocks:Math.ceil(n/i),atime:t.lastModified,mtime:t.lastModified,ctime:t.lastModified}}mkdir(e,t){u(this,h,he).call(this,{opp:"mkdir",args:[e,t]},()=>{this._mkdirState(e,t)})}_mkdirState(e,t){let n=u(this,h,$).call(this,e),i=n.pop(),s=[],o=this.state.root;for(let l of n){if(s.push(e),!Object.prototype.hasOwnProperty.call(o.children,l))if(t?.recursive)this.mkdir(s.join("/"));else throw new A("ENOENT","No such file or directory");if(o.children[l].type!=="directory")throw new A("ENOTDIR","Not a directory");o=o.children[l]}if(Object.prototype.hasOwnProperty.call(o.children,i))throw new A("EEXIST","File exists");let c={type:"directory",lastModified:Date.now(),mode:t?.mode||gr.DIR,children:{}};o.children[i]=c}open(e,t,n){if(u(this,h,M).call(this,e).type!=="file")throw new A("EISDIR","Is a directory");let s=u(this,h,In).call(this);return a(this,se).set(s,e),a(this,ae).set(e,s),s}readdir(e){let t=u(this,h,M).call(this,e);if(t.type!=="directory")throw new A("ENOTDIR","Not a directory");return Object.keys(t.children)}read(e,t,n,i,s){let o=u(this,h,Ke).call(this,e),c=u(this,h,M).call(this,o);if(c.type!=="file")throw new A("EISDIR","Is a directory");return a(this,N).get(c.backingFilename).read(new Int8Array(t.buffer,n,i),{at:s})}rename(e,t){u(this,h,he).call(this,{opp:"rename",args:[e,t]},()=>{this._renameState(e,t,!0)})}_renameState(e,t,n=!1){let i=u(this,h,$).call(this,e),s=i.pop(),o=u(this,h,M).call(this,i.join("/"));if(!Object.prototype.hasOwnProperty.call(o.children,s))throw new A("ENOENT","No such file or directory");let c=u(this,h,$).call(this,t),l=c.pop(),p=u(this,h,M).call(this,c.join("/"));if(n&&Object.prototype.hasOwnProperty.call(p.children,l)){let m=p.children[l];a(this,N).get(m.backingFilename).truncate(0),this.state.pool.push(m.backingFilename)}p.children[l]=o.children[s],delete o.children[s]}rmdir(e){u(this,h,he).call(this,{opp:"rmdir",args:[e]},()=>{this._rmdirState(e)})}_rmdirState(e){let t=u(this,h,$).call(this,e),n=t.pop(),i=u(this,h,M).call(this,t.join("/"));if(!Object.prototype.hasOwnProperty.call(i.children,n))throw new A("ENOENT","No such file or directory");let s=i.children[n];if(s.type!=="directory")throw new A("ENOTDIR","Not a directory");if(Object.keys(s.children).length>0)throw new A("ENOTEMPTY","Directory not empty");delete i.children[n]}truncate(e,t=0){let n=u(this,h,M).call(this,e);if(n.type!=="file")throw new A("EISDIR","Is a directory");let i=a(this,N).get(n.backingFilename);if(!i)throw new A("ENOENT","No such file or directory");i.truncate(t),a(this,Y).add(i)}unlink(e){u(this,h,he).call(this,{opp:"unlink",args:[e]},()=>{this._unlinkState(e,!0)})}_unlinkState(e,t=!1){let n=u(this,h,$).call(this,e),i=n.pop(),s=u(this,h,M).call(this,n.join("/"));if(!Object.prototype.hasOwnProperty.call(s.children,i))throw new A("ENOENT","No such file or directory");let o=s.children[i];if(o.type!=="file")throw new A("EISDIR","Is a directory");if(delete s.children[i],t){let c=a(this,N).get(o.backingFilename);c?.truncate(0),a(this,Y).add(c),a(this,ae).has(e)&&(a(this,se).delete(a(this,ae).get(e)),a(this,ae).delete(e))}this.state.pool.push(o.backingFilename)}utimes(e,t,n){u(this,h,he).call(this,{opp:"utimes",args:[e,t,n]},()=>{this._utimesState(e,t,n)})}_utimesState(e,t,n){let i=u(this,h,M).call(this,e);i.lastModified=n}writeFile(e,t,n){let i=u(this,h,$).call(this,e),s=i.pop(),o=u(this,h,M).call(this,i.join("/"));if(Object.prototype.hasOwnProperty.call(o.children,s)){let p=o.children[s];p.lastModified=Date.now(),u(this,h,Re).call(this,{opp:"setLastModified",args:[e,p.lastModified]})}else{if(this.state.pool.length===0)throw new Error("No more file handles available in the pool");let p={type:"file",lastModified:Date.now(),mode:n?.mode||gr.FILE,backingFilename:this.state.pool.pop()};o.children[s]=p,u(this,h,Re).call(this,{opp:"createFileNode",args:[e,p]})}let c=o.children[s],l=a(this,N).get(c.backingFilename);t.length>0&&(l.write(typeof t=="string"?new TextEncoder().encode(t):new Int8Array(t),{at:0}),e.startsWith("/pg_wal")&&a(this,Y).add(l))}_createFileNodeState(e,t){let n=u(this,h,$).call(this,e),i=n.pop(),s=u(this,h,M).call(this,n.join("/"));s.children[i]=t;let o=this.state.pool.indexOf(t.backingFilename);return o>-1&&this.state.pool.splice(o,1),t}_setLastModifiedState(e,t){let n=u(this,h,M).call(this,e);n.lastModified=t}write(e,t,n,i,s){let o=u(this,h,Ke).call(this,e),c=u(this,h,M).call(this,o);if(c.type!=="file")throw new A("EISDIR","Is a directory");let l=a(this,N).get(c.backingFilename);if(!l)throw new A("EBADF","Bad file descriptor");let p=l.write(new Int8Array(t,n,i),{at:s});return o.startsWith("/pg_wal")&&a(this,Y).add(l),p}};Xe=new WeakMap,Je=new WeakMap,_e=new WeakMap,ge=new WeakMap,Ze=new WeakMap,D=new WeakMap,J=new WeakMap,N=new WeakMap,et=new WeakMap,se=new WeakMap,ae=new WeakMap,Y=new WeakMap,h=new WeakSet,On=async function(){f(this,Je,await navigator.storage.getDirectory()),f(this,_e,await u(this,h,br).call(this,this.root,{create:!0})),f(this,ge,await u(this,h,br).call(this,ys,{from:a(this,_e),create:!0})),f(this,Ze,await a(this,_e).getFileHandle(fs,{create:!0})),f(this,D,await a(this,Ze).createSyncAccessHandle());let e=new ArrayBuffer(a(this,D).getSize());a(this,D).read(e,{at:0});let t,n=new TextDecoder().decode(e).split(`
`),i=!1;try{t=JSON.parse(n[0])}catch{t={root:{type:"directory",lastModified:Date.now(),mode:gr.DIR,children:{}},pool:[]},a(this,D).truncate(0),a(this,D).write(new TextEncoder().encode(JSON.stringify(t)),{at:0}),i=!0}this.state=t;let s=n.slice(1).filter(Boolean).map(p=>JSON.parse(p));for(let p of s){let m=`_${p.opp}State`;if(typeof this[m]=="function")try{this[m].bind(this)(...p.args)}catch(g){console.warn("Error applying OPFS AHP WAL entry",p,g)}}let o=[],c=async p=>{if(p.type==="file")try{let m=await a(this,ge).getFileHandle(p.backingFilename),g=await m.createSyncAccessHandle();a(this,J).set(p.backingFilename,m),a(this,N).set(p.backingFilename,g)}catch(m){console.error("Error opening file handle for node",p,m)}else for(let m of Object.values(p.children))o.push(c(m))};await c(this.state.root);let l=[];for(let p of this.state.pool)l.push(new Promise(async m=>{a(this,J).has(p)&&console.warn("File handle already exists for pool file",p);let g=await a(this,ge).getFileHandle(p),x=await g.createSyncAccessHandle();a(this,J).set(p,g),a(this,N).set(p,x),m()}));await Promise.all([...o,...l]),await this.maintainPool(i?this.initialPoolSize:this.maintainedPoolSize),f(this,Xe,!0)},he=function(e,t){let n=u(this,h,Re).call(this,e);try{t()}catch(i){throw a(this,D).truncate(n),i}},Re=function(e){let t=JSON.stringify(e),n=new TextEncoder().encode(`
${t}`),i=a(this,D).getSize();return a(this,D).write(n,{at:i}),a(this,Y).add(a(this,D)),i},$=function(e){return e.split("/").filter(Boolean)},M=function(e,t){let n=u(this,h,$).call(this,e),i=t||this.state.root;for(let s of n){if(i.type!=="directory")throw new A("ENOTDIR","Not a directory");if(!Object.prototype.hasOwnProperty.call(i.children,s))throw new A("ENOENT","No such file or directory");i=i.children[s]}return i},Ke=function(e){let t=a(this,se).get(e);if(!t)throw new A("EBADF","Bad file descriptor");return t},In=function(){let e=++me(this,et)._;for(;a(this,se).has(e);)me(this,et)._++;return e},br=async function(e,t){let n=u(this,h,$).call(this,e),i=t?.from||a(this,Je);for(let s of n)i=await i.getDirectoryHandle(s,{create:t?.create});return i};Lt=wr});var Mn={};de(Mn,{OpfsAhpFS:()=>Sr});var tt,rt,Sr,Nn=H(()=>{"use strict";d();Ve();ye();Dn();vn();ve();Sr=class extends W{constructor(t,{initialPoolSize:n,maintainedPoolSize:i}={}){super(t);y(this,tt);y(this,rt);f(this,tt,n??1e3),f(this,rt,i??100)}async emscriptenOpts(t){return this.opfsAhp=await Lt.create({root:this.dataDir,initialPoolSize:a(this,tt),maintainedPoolSize:a(this,rt)}),{...t,preRun:[...t.preRun||[],i=>{let s=Fn(i,this.opfsAhp);i.FS.mkdir(B),i.FS.mount(s,{},B)}]}}async syncToFs(t,n=!1){await this.opfsAhp?.maybeCheckpointState(),await this.opfsAhp?.maintainPool(),n||this.opfsAhp?.flush()}async dumpTar(t,n,i){return ie(t,n,i)}async close(t){this.opfsAhp?.exit(),t.quit()}};tt=new WeakMap,rt=new WeakMap});function Rn(r){let e;if(r?.startsWith("file://")){if(r=r.slice(7),!r)throw new Error("Invalid dataDir, must be a valid path");e="nodefs"}else r?.startsWith("idb://")?(r=r.slice(6),e="idbfs"):r?.startsWith("opfs-ahp://")?(r=r.slice(11),e="opfs-ahp"):!r||r?.startsWith("memory://")?e="memoryfs":e="nodefs";return{dataDir:r,fsType:e}}async function _n(r,e){let t;if(r&&e==="nodefs"){let{NodeFS:n}=await Promise.resolve().then(()=>(En(),An));t=new n(r)}else if(r&&e==="idbfs")t=new Me(r);else if(r&&e==="opfs-ahp"){let{OpfsAhpFS:n}=await Promise.resolve().then(()=>(Nn(),Mn));t=new n(r)}else t=new Ne;return t}var zt,B,ye=H(()=>{"use strict";d();mr();fr();zt="/tmp/pglite",B=zt+"/base"});var Ga={};de(Ga,{IdbFs:()=>Me,MemoryFS:()=>Ne,Mutex:()=>re,PGlite:()=>Kr,formatQuery:()=>yi,messages:()=>bt,parse:()=>Vr,protocol:()=>_r,types:()=>Wr,uuid:()=>fi});module.exports=Ei(Ga);d();d();d();var qa=new Error("timeout while waiting for mutex to become available"),Wa=new Error("mutex already locked"),Di=new Error("request for lock canceled"),Oi=function(r,e,t,n){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function c(m){try{p(n.next(m))}catch(g){o(g)}}function l(m){try{p(n.throw(m))}catch(g){o(g)}}function p(m){m.done?s(m.value):i(m.value).then(c,l)}p((n=n.apply(r,e||[])).next())})},ir=class{constructor(e,t=Di){this._value=e,this._cancelError=t,this._weightedQueues=[],this._weightedWaiters=[]}acquire(e=1){if(e<=0)throw new Error(`invalid weight ${e}: must be positive`);return new Promise((t,n)=>{this._weightedQueues[e-1]||(this._weightedQueues[e-1]=[]),this._weightedQueues[e-1].push({resolve:t,reject:n}),this._dispatch()})}runExclusive(e,t=1){return Oi(this,void 0,void 0,function*(){let[n,i]=yield this.acquire(t);try{return yield e(n)}finally{i()}})}waitForUnlock(e=1){if(e<=0)throw new Error(`invalid weight ${e}: must be positive`);return new Promise(t=>{this._weightedWaiters[e-1]||(this._weightedWaiters[e-1]=[]),this._weightedWaiters[e-1].push(t),this._dispatch()})}isLocked(){return this._value<=0}getValue(){return this._value}setValue(e){this._value=e,this._dispatch()}release(e=1){if(e<=0)throw new Error(`invalid weight ${e}: must be positive`);this._value+=e,this._dispatch()}cancel(){this._weightedQueues.forEach(e=>e.forEach(t=>t.reject(this._cancelError))),this._weightedQueues=[]}_dispatch(){var e;for(let t=this._value;t>0;t--){let n=(e=this._weightedQueues[t-1])===null||e===void 0?void 0:e.shift();if(!n)continue;let i=this._value,s=t;this._value-=t,t=this._value+1,n.resolve([i,this._newReleaser(s)])}this._drainUnlockWaiters()}_newReleaser(e){let t=!1;return()=>{t||(t=!0,this.release(e))}}_drainUnlockWaiters(){for(let e=this._value;e>0;e--)this._weightedWaiters[e-1]&&(this._weightedWaiters[e-1].forEach(t=>t()),this._weightedWaiters[e-1]=[])}},Ii=function(r,e,t,n){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function c(m){try{p(n.next(m))}catch(g){o(g)}}function l(m){try{p(n.throw(m))}catch(g){o(g)}}function p(m){m.done?s(m.value):i(m.value).then(c,l)}p((n=n.apply(r,e||[])).next())})},re=class{constructor(e){this._semaphore=new ir(1,e)}acquire(){return Ii(this,void 0,void 0,function*(){let[,e]=yield this._semaphore.acquire();return e})}runExclusive(e){return this._semaphore.runExclusive(()=>e())}isLocked(){return this._semaphore.isLocked()}waitForUnlock(){return this._semaphore.waitForUnlock()}release(){this._semaphore.isLocked()&&this._semaphore.release()}cancel(){return this._semaphore.cancel()}};d();var rn=_(require("./postgres.cjs").default,1),nn=rn.default;ye();d();var _r={};de(_r,{Parser:()=>Pe,messages:()=>bt,serialize:()=>v});d();d();d();d();function Be(r){let e=r.length;for(let t=r.length-1;t>=0;t--){let n=r.charCodeAt(t);n>127&&n<=2047?e++:n>2047&&n<=65535&&(e+=2),n>=56320&&n<=57343&&t--}return e}var O,I,Ce,jt,Ue,z,Gt,ke,Bn,be=class{constructor(e=256){this.size=e;y(this,z);y(this,O);y(this,I,5);y(this,Ce,!1);y(this,jt,new TextEncoder);y(this,Ue,0);f(this,O,u(this,z,Gt).call(this,e))}addInt32(e){return u(this,z,ke).call(this,4),a(this,O).setInt32(a(this,I),e,a(this,Ce)),f(this,I,a(this,I)+4),this}addInt16(e){return u(this,z,ke).call(this,2),a(this,O).setInt16(a(this,I),e,a(this,Ce)),f(this,I,a(this,I)+2),this}addCString(e){return e&&this.addString(e),u(this,z,ke).call(this,1),a(this,O).setUint8(a(this,I),0),me(this,I)._++,this}addString(e=""){let t=Be(e);return u(this,z,ke).call(this,t),a(this,jt).encodeInto(e,new Uint8Array(a(this,O).buffer,a(this,I))),f(this,I,a(this,I)+t),this}add(e){return u(this,z,ke).call(this,e.byteLength),new Uint8Array(a(this,O).buffer).set(new Uint8Array(e),a(this,I)),f(this,I,a(this,I)+e.byteLength),this}flush(e){let t=u(this,z,Bn).call(this,e);return f(this,I,5),f(this,O,u(this,z,Gt).call(this,this.size)),new Uint8Array(t)}};O=new WeakMap,I=new WeakMap,Ce=new WeakMap,jt=new WeakMap,Ue=new WeakMap,z=new WeakSet,Gt=function(e){return new DataView(new ArrayBuffer(e))},ke=function(e){if(a(this,O).byteLength-a(this,I)<e){let n=a(this,O).buffer,i=n.byteLength+(n.byteLength>>1)+e;f(this,O,u(this,z,Gt).call(this,i)),new Uint8Array(a(this,O).buffer).set(new Uint8Array(n))}},Bn=function(e){if(e){a(this,O).setUint8(a(this,Ue),e);let t=a(this,I)-(a(this,Ue)+1);a(this,O).setInt32(a(this,Ue)+1,t,a(this,Ce))}return a(this,O).buffer.slice(e?0:5,a(this,I))};var T=new be,hs=r=>{T.addInt16(3).addInt16(0);for(let n of Object.keys(r))T.addCString(n).addCString(r[n]);T.addCString("client_encoding").addCString("UTF8");let e=T.addCString("").flush(),t=e.byteLength+4;return new be().addInt32(t).add(e).flush()},gs=()=>{let r=new DataView(new ArrayBuffer(8));return r.setInt32(0,8,!1),r.setInt32(4,80877103,!1),new Uint8Array(r.buffer)},bs=r=>T.addCString(r).flush(112),ws=(r,e)=>(T.addCString(r).addInt32(Be(e)).addString(e),T.flush(112)),Ss=r=>T.addString(r).flush(112),xs=r=>T.addCString(r).flush(81),Ps=[],Ts=r=>{let e=r.name??"";e.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",e,e.length),console.error("This can cause conflicts and silent errors executing queries"));let t=T.addCString(e).addCString(r.text).addInt16(r.types?.length??0);return r.types?.forEach(n=>t.addInt32(n)),T.flush(80)},Le=new be;var As=(r,e)=>{for(let t=0;t<r.length;t++){let n=e?e(r[t],t):r[t];if(n===null)T.addInt16(0),Le.addInt32(-1);else if(n instanceof ArrayBuffer||ArrayBuffer.isView(n)){let i=ArrayBuffer.isView(n)?n.buffer.slice(n.byteOffset,n.byteOffset+n.byteLength):n;T.addInt16(1),Le.addInt32(i.byteLength),Le.add(i)}else T.addInt16(0),Le.addInt32(Be(n)),Le.addString(n)}},Es=(r={})=>{let e=r.portal??"",t=r.statement??"",n=r.binary??!1,i=r.values??Ps,s=i.length;return T.addCString(e).addCString(t),T.addInt16(s),As(i,r.valueMapper),T.addInt16(s),T.add(Le.flush()),T.addInt16(n?1:0),T.flush(66)},Fs=new Uint8Array([69,0,0,0,9,0,0,0,0,0]),Ds=r=>{if(!r||!r.portal&&!r.rows)return Fs;let e=r.portal??"",t=r.rows??0,n=Be(e),i=4+n+1+4,s=new DataView(new ArrayBuffer(1+i));return s.setUint8(0,69),s.setInt32(1,i,!1),new TextEncoder().encodeInto(e,new Uint8Array(s.buffer,5)),s.setUint8(n+5,0),s.setUint32(s.byteLength-4,t,!1),new Uint8Array(s.buffer)},Os=(r,e)=>{let t=new DataView(new ArrayBuffer(16));return t.setInt32(0,16,!1),t.setInt16(4,1234,!1),t.setInt16(6,5678,!1),t.setInt32(8,r,!1),t.setInt32(12,e,!1),new Uint8Array(t.buffer)},xr=(r,e)=>{let t=new be;return t.addCString(e),t.flush(r)},Is=T.addCString("P").flush(68),vs=T.addCString("S").flush(68),Ms=r=>r.name?xr(68,`${r.type}${r.name??""}`):r.type==="P"?Is:vs,Ns=r=>{let e=`${r.type}${r.name??""}`;return xr(67,e)},Rs=r=>T.add(r).flush(100),_s=r=>xr(102,r),Ht=r=>new Uint8Array([r,0,0,0,4]),Bs=Ht(72),ks=Ht(83),Cs=Ht(88),Us=Ht(99),v={startup:hs,password:bs,requestSsl:gs,sendSASLInitialResponseMessage:ws,sendSCRAMClientFinalMessage:Ss,query:xs,parse:Ts,bind:Es,execute:Ds,describe:Ms,close:Ns,flush:()=>Bs,sync:()=>ks,end:()=>Cs,copyData:Rs,copyDone:()=>Us,copyFail:_s,cancel:Os};d();var bt={};de(bt,{AuthenticationCleartextPassword:()=>it,AuthenticationMD5Password:()=>st,AuthenticationOk:()=>nt,AuthenticationSASL:()=>at,AuthenticationSASLContinue:()=>ot,AuthenticationSASLFinal:()=>ct,BackendKeyDataMessage:()=>yt,CommandCompleteMessage:()=>Se,CopyDataMessage:()=>lt,CopyResponse:()=>ut,DataRowMessage:()=>gt,DatabaseError:()=>oe,Field:()=>pt,NoticeMessage:()=>xe,NotificationResponseMessage:()=>we,ParameterDescriptionMessage:()=>mt,ParameterStatusMessage:()=>ft,ReadyForQueryMessage:()=>ht,RowDescriptionMessage:()=>dt,bindComplete:()=>Tr,closeComplete:()=>Ar,copyDone:()=>Ir,emptyQuery:()=>Or,noData:()=>Er,parseComplete:()=>Pr,portalSuspended:()=>Fr,replicationStart:()=>Dr});d();var Pr={name:"parseComplete",length:5},Tr={name:"bindComplete",length:5},Ar={name:"closeComplete",length:5},Er={name:"noData",length:5},Fr={name:"portalSuspended",length:5},Dr={name:"replicationStart",length:4},Or={name:"emptyQuery",length:4},Ir={name:"copyDone",length:4},nt=class{constructor(e){this.length=e;this.name="authenticationOk"}},it=class{constructor(e){this.length=e;this.name="authenticationCleartextPassword"}},st=class{constructor(e,t){this.length=e;this.salt=t;this.name="authenticationMD5Password"}},at=class{constructor(e,t){this.length=e;this.mechanisms=t;this.name="authenticationSASL"}},ot=class{constructor(e,t){this.length=e;this.data=t;this.name="authenticationSASLContinue"}},ct=class{constructor(e,t){this.length=e;this.data=t;this.name="authenticationSASLFinal"}},oe=class extends Error{constructor(t,n,i){super(t);this.length=n;this.name=i}},lt=class{constructor(e,t){this.length=e;this.chunk=t;this.name="copyData"}},ut=class{constructor(e,t,n,i){this.length=e;this.name=t;this.binary=n;this.columnTypes=new Array(i)}},pt=class{constructor(e,t,n,i,s,o,c){this.name=e;this.tableID=t;this.columnID=n;this.dataTypeID=i;this.dataTypeSize=s;this.dataTypeModifier=o;this.format=c}},dt=class{constructor(e,t){this.length=e;this.fieldCount=t;this.name="rowDescription";this.fields=new Array(this.fieldCount)}},mt=class{constructor(e,t){this.length=e;this.parameterCount=t;this.name="parameterDescription";this.dataTypeIDs=new Array(this.parameterCount)}},ft=class{constructor(e,t,n){this.length=e;this.parameterName=t;this.parameterValue=n;this.name="parameterStatus"}},yt=class{constructor(e,t,n){this.length=e;this.processID=t;this.secretKey=n;this.name="backendKeyData"}},we=class{constructor(e,t,n,i){this.length=e;this.processId=t;this.channel=n;this.payload=i;this.name="notification"}},ht=class{constructor(e,t){this.length=e;this.status=t;this.name="readyForQuery"}},Se=class{constructor(e,t){this.length=e;this.text=t;this.name="commandComplete"}},gt=class{constructor(e,t){this.length=e;this.fields=t;this.name="dataRow";this.fieldCount=t.length}},xe=class{constructor(e,t){this.length=e;this.message=t;this.name="notice"}};d();var vr={text:0,binary:1};d();var Ls=new ArrayBuffer(0),Z,R,Wt,Vt,wt,qt=class{constructor(e=0){y(this,Z,new DataView(Ls));y(this,R);y(this,Wt,"utf-8");y(this,Vt,new TextDecoder(a(this,Wt)));y(this,wt,!1);f(this,R,e)}setBuffer(e,t){f(this,R,e),f(this,Z,new DataView(t))}int16(){let e=a(this,Z).getInt16(a(this,R),a(this,wt));return f(this,R,a(this,R)+2),e}byte(){let e=a(this,Z).getUint8(a(this,R));return me(this,R)._++,e}int32(){let e=a(this,Z).getInt32(a(this,R),a(this,wt));return f(this,R,a(this,R)+4),e}string(e){return a(this,Vt).decode(this.bytes(e))}cstring(){let e=a(this,R),t=e;for(;a(this,Z).getUint8(t++)!==0;);let n=this.string(t-e-1);return f(this,R,t),n}bytes(e){let t=a(this,Z).buffer.slice(a(this,R),a(this,R)+e);return f(this,R,a(this,R)+e),new Uint8Array(t)}};Z=new WeakMap,R=new WeakMap,Wt=new WeakMap,Vt=new WeakMap,wt=new WeakMap;var Mr=1,zs=4,kn=Mr+zs,Cn=new ArrayBuffer(0);var k,G,j,b,S,Un,Ln,zn,Gn,jn,Hn,qn,Nr,Wn,Vn,Qn,$n,Yn,Kn,Xn,Jn,Rr,Pe=class{constructor(){y(this,S);y(this,k,new DataView(Cn));y(this,G,0);y(this,j,0);y(this,b,new qt)}parse(e,t){u(this,S,Un).call(this,ArrayBuffer.isView(e)?e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength):e);let n=a(this,j)+a(this,G),i=a(this,j);for(;i+kn<=n;){let s=a(this,k).getUint8(i),o=a(this,k).getUint32(i+Mr,!1),c=Mr+o;if(c+i<=n){let l=u(this,S,Ln).call(this,i+kn,s,o,a(this,k).buffer);t(l),i+=c}else break}i===n?(f(this,k,new DataView(Cn)),f(this,G,0),f(this,j,0)):(f(this,G,n-i),f(this,j,i))}};k=new WeakMap,G=new WeakMap,j=new WeakMap,b=new WeakMap,S=new WeakSet,Un=function(e){if(a(this,G)>0){let t=a(this,G)+e.byteLength;if(t+a(this,j)>a(this,k).byteLength){let i;if(t<=a(this,k).byteLength&&a(this,j)>=a(this,G))i=a(this,k).buffer;else{let s=a(this,k).byteLength*2;for(;t>=s;)s*=2;i=new ArrayBuffer(s)}new Uint8Array(i).set(new Uint8Array(a(this,k).buffer,a(this,j),a(this,G))),f(this,k,new DataView(i)),f(this,j,0)}new Uint8Array(a(this,k).buffer).set(new Uint8Array(e),a(this,j)+a(this,G)),f(this,G,t)}else f(this,k,new DataView(e)),f(this,j,0),f(this,G,e.byteLength)},Ln=function(e,t,n,i){switch(t){case 50:return Tr;case 49:return Pr;case 51:return Ar;case 110:return Er;case 115:return Fr;case 99:return Ir;case 87:return Dr;case 73:return Or;case 68:return u(this,S,Yn).call(this,e,n,i);case 67:return u(this,S,Gn).call(this,e,n,i);case 90:return u(this,S,zn).call(this,e,n,i);case 65:return u(this,S,Wn).call(this,e,n,i);case 82:return u(this,S,Jn).call(this,e,n,i);case 83:return u(this,S,Kn).call(this,e,n,i);case 75:return u(this,S,Xn).call(this,e,n,i);case 69:return u(this,S,Rr).call(this,e,n,i,"error");case 78:return u(this,S,Rr).call(this,e,n,i,"notice");case 84:return u(this,S,Vn).call(this,e,n,i);case 116:return u(this,S,$n).call(this,e,n,i);case 71:return u(this,S,Hn).call(this,e,n,i);case 72:return u(this,S,qn).call(this,e,n,i);case 100:return u(this,S,jn).call(this,e,n,i);default:return new oe("received invalid response: "+t.toString(16),n,"error")}},zn=function(e,t,n){a(this,b).setBuffer(e,n);let i=a(this,b).string(1);return new ht(t,i)},Gn=function(e,t,n){a(this,b).setBuffer(e,n);let i=a(this,b).cstring();return new Se(t,i)},jn=function(e,t,n){let i=n.slice(e,e+(t-4));return new lt(t,new Uint8Array(i))},Hn=function(e,t,n){return u(this,S,Nr).call(this,e,t,n,"copyInResponse")},qn=function(e,t,n){return u(this,S,Nr).call(this,e,t,n,"copyOutResponse")},Nr=function(e,t,n,i){a(this,b).setBuffer(e,n);let s=a(this,b).byte()!==0,o=a(this,b).int16(),c=new ut(t,i,s,o);for(let l=0;l<o;l++)c.columnTypes[l]=a(this,b).int16();return c},Wn=function(e,t,n){a(this,b).setBuffer(e,n);let i=a(this,b).int32(),s=a(this,b).cstring(),o=a(this,b).cstring();return new we(t,i,s,o)},Vn=function(e,t,n){a(this,b).setBuffer(e,n);let i=a(this,b).int16(),s=new dt(t,i);for(let o=0;o<i;o++)s.fields[o]=u(this,S,Qn).call(this);return s},Qn=function(){let e=a(this,b).cstring(),t=a(this,b).int32(),n=a(this,b).int16(),i=a(this,b).int32(),s=a(this,b).int16(),o=a(this,b).int32(),c=a(this,b).int16()===0?vr.text:vr.binary;return new pt(e,t,n,i,s,o,c)},$n=function(e,t,n){a(this,b).setBuffer(e,n);let i=a(this,b).int16(),s=new mt(t,i);for(let o=0;o<i;o++)s.dataTypeIDs[o]=a(this,b).int32();return s},Yn=function(e,t,n){a(this,b).setBuffer(e,n);let i=a(this,b).int16(),s=new Array(i);for(let o=0;o<i;o++){let c=a(this,b).int32();s[o]=c===-1?null:a(this,b).string(c)}return new gt(t,s)},Kn=function(e,t,n){a(this,b).setBuffer(e,n);let i=a(this,b).cstring(),s=a(this,b).cstring();return new ft(t,i,s)},Xn=function(e,t,n){a(this,b).setBuffer(e,n);let i=a(this,b).int32(),s=a(this,b).int32();return new yt(t,i,s)},Jn=function(e,t,n){a(this,b).setBuffer(e,n);let i=a(this,b).int32();switch(i){case 0:return new nt(t);case 3:return new it(t);case 5:return new st(t,a(this,b).bytes(4));case 10:{let s=[];for(;;){let o=a(this,b).cstring();if(o.length===0)return new at(t,s);s.push(o)}}case 11:return new ot(t,a(this,b).string(t-8));case 12:return new ct(t,a(this,b).string(t-8));default:throw new Error("Unknown authenticationOk message type "+i)}},Rr=function(e,t,n,i){a(this,b).setBuffer(e,n);let s={},o=a(this,b).string(1);for(;o!=="\0";)s[o]=a(this,b).cstring(),o=a(this,b).string(1);let c=s.M,l=i==="notice"?new xe(t,c):new oe(c,t,i);return l.severity=s.S,l.code=s.C,l.detail=s.D,l.hint=s.H,l.position=s.P,l.internalPosition=s.p,l.internalQuery=s.q,l.where=s.W,l.schema=s.s,l.table=s.t,l.column=s.c,l.dataType=s.d,l.constraint=s.n,l.file=s.F,l.line=s.L,l.routine=s.R,l};var Vr={};de(Vr,{parseDescribeStatementResults:()=>xt,parseResults:()=>Yt});d();var Wr={};de(Wr,{ABSTIME:()=>ea,ACLITEM:()=>ca,BIT:()=>da,BOOL:()=>kr,BPCHAR:()=>ii,BYTEA:()=>Cr,CHAR:()=>Hs,CID:()=>Qs,CIDR:()=>Zs,CIRCLE:()=>na,DATE:()=>ai,FLOAT4:()=>ri,FLOAT8:()=>ni,GTSVECTOR:()=>Oa,INET:()=>oa,INT2:()=>Zn,INT4:()=>ei,INT8:()=>Ur,INTERVAL:()=>ua,JSON:()=>Lr,JSONB:()=>ci,MACADDR:()=>aa,MACADDR8:()=>ia,MONEY:()=>sa,NUMERIC:()=>fa,OID:()=>ti,PATH:()=>Xs,PG_DEPENDENCIES:()=>Ea,PG_LSN:()=>Ta,PG_NDISTINCT:()=>Aa,PG_NODE_TREE:()=>Ys,POLYGON:()=>Js,REFCURSOR:()=>ya,REGCLASS:()=>wa,REGCONFIG:()=>Ia,REGDICTIONARY:()=>va,REGNAMESPACE:()=>Ma,REGOPER:()=>ga,REGOPERATOR:()=>ba,REGPROC:()=>qs,REGPROCEDURE:()=>ha,REGROLE:()=>Na,REGTYPE:()=>Sa,RELTIME:()=>ta,SMGR:()=>Ks,TEXT:()=>St,TID:()=>Ws,TIME:()=>la,TIMESTAMP:()=>oi,TIMESTAMPTZ:()=>zr,TIMETZ:()=>pa,TINTERVAL:()=>ra,TSQUERY:()=>Da,TSVECTOR:()=>Fa,TXID_SNAPSHOT:()=>Pa,UUID:()=>xa,VARBIT:()=>ma,VARCHAR:()=>si,XID:()=>Vs,XML:()=>$s,arrayParser:()=>qr,arraySerializer:()=>$t,parseType:()=>Qt,parsers:()=>jr,serializers:()=>Hr,types:()=>li});d();var Gs=globalThis.JSON.parse,js=globalThis.JSON.stringify,kr=16,Cr=17,Hs=18,Ur=20,Zn=21,ei=23,qs=24,St=25,ti=26,Ws=27,Vs=28,Qs=29,Lr=114,$s=142,Ys=194,Ks=210,Xs=602,Js=604,Zs=650,ri=700,ni=701,ea=702,ta=703,ra=704,na=718,ia=774,sa=790,aa=829,oa=869,ca=1033,ii=1042,si=1043,ai=1082,la=1083,oi=1114,zr=1184,ua=1186,pa=1266,da=1560,ma=1562,fa=1700,ya=1790,ha=2202,ga=2203,ba=2204,wa=2205,Sa=2206,xa=2950,Pa=2970,Ta=3220,Aa=3361,Ea=3402,Fa=3614,Da=3615,Oa=3642,Ia=3734,va=3769,ci=3802,Ma=4089,Na=4096,li={string:{to:St,from:[St,si,ii],serialize:r=>{if(typeof r=="string")return r;if(typeof r=="number")return r.toString();throw new Error("Invalid input for string type")},parse:r=>r},number:{to:0,from:[Zn,ei,ti,ri,ni],serialize:r=>r.toString(),parse:r=>+r},bigint:{to:Ur,from:[Ur],serialize:r=>r.toString(),parse:r=>{let e=BigInt(r);return e<Number.MIN_SAFE_INTEGER||e>Number.MAX_SAFE_INTEGER?e:Number(e)}},json:{to:Lr,from:[Lr,ci],serialize:r=>js(r),parse:r=>Gs(r)},boolean:{to:kr,from:[kr],serialize:r=>{if(typeof r!="boolean")throw new Error("Invalid input for boolean type");return r?"t":"f"},parse:r=>r==="t"},date:{to:zr,from:[ai,oi,zr],serialize:r=>{if(typeof r=="string")return r;if(typeof r=="number")return new Date(r).toISOString();if(r instanceof Date)return r.toISOString();throw new Error("Invalid input for date type")},parse:r=>new Date(r)},bytea:{to:Cr,from:[Cr],serialize:r=>{if(!(r instanceof Uint8Array))throw new Error("Invalid input for bytea type");return"\\x"+Array.from(r).map(e=>e.toString(16).padStart(2,"0")).join("")},parse:r=>{let e=r.slice(2);return Uint8Array.from({length:e.length/2},(t,n)=>parseInt(e.substring(n*2,(n+1)*2),16))}}},Gr=Ra(li),jr=Gr.parsers,Hr=Gr.serializers;function Qt(r,e,t){if(r===null)return null;let n=t?.[e]??Gr.parsers[e];return n?n(r,e):r}function Ra(r){return Object.keys(r).reduce(({parsers:e,serializers:t},n)=>{let{to:i,from:s,serialize:o,parse:c}=r[n];return t[i]=o,t[n]=o,e[n]=c,Array.isArray(s)?s.forEach(l=>{e[l]=c,t[l]=o}):(e[s]=c,t[s]=o),{parsers:e,serializers:t}},{parsers:{},serializers:{}})}var _a=/\\/g,Ba=/"/g;function ka(r){return r.replace(_a,"\\\\").replace(Ba,'\\"')}function $t(r,e,t){if(Array.isArray(r)===!1)return r;if(!r.length)return"{}";let n=r[0],i=t===1020?";":",";return Array.isArray(n)?`{${r.map(s=>$t(s,e,t)).join(i)}}`:`{${r.map(s=>(s===void 0&&(s=null),s===null?"null":'"'+ka(e?e(s):s.toString())+'"')).join(i)}}`}var Br={i:0,char:null,str:"",quoted:!1,last:0,p:null};function qr(r,e,t){return Br.i=Br.last=0,ui(Br,r,e,t)[0]}function ui(r,e,t,n){let i=[],s=n===1020?";":",";for(;r.i<e.length;r.i++){if(r.char=e[r.i],r.quoted)r.char==="\\"?r.str+=e[++r.i]:r.char==='"'?(i.push(t?t(r.str):r.str),r.str="",r.quoted=e[r.i+1]==='"',r.last=r.i+2):r.str+=r.char;else if(r.char==='"')r.quoted=!0;else if(r.char==="{")r.last=++r.i,i.push(ui(r,e,t,n));else if(r.char==="}"){r.quoted=!1,r.last<r.i&&i.push(t?t(e.slice(r.last,r.i)):e.slice(r.last,r.i)),r.last=r.i+1;break}else r.char===s&&r.p!=="}"&&r.p!=='"'&&(i.push(t?t(e.slice(r.last,r.i)):e.slice(r.last,r.i)),r.last=r.i+1);r.p=r.char}return r.last<r.i&&i.push(t?t(e.slice(r.last,r.i+1)):e.slice(r.last,r.i+1)),i}function Yt(r,e,t,n){let i=[],s={rows:[],fields:[]},o=0,c={...e,...t?.parsers},l=r.filter(p=>p.name==="rowDescription"||p.name==="dataRow"||p.name==="commandComplete");return l.forEach((p,m)=>{if(p.name==="rowDescription"){let g=p;s.fields=g.fields.map(x=>({name:x.name,dataTypeID:x.dataTypeID}))}else if(p.name==="dataRow"&&s){let g=p;t?.rowMode==="array"?s.rows.push(g.fields.map((x,C)=>Qt(x,s.fields[C].dataTypeID,c))):s.rows.push(Object.fromEntries(g.fields.map((x,C)=>[s.fields[C].name,Qt(x,s.fields[C].dataTypeID,c)])))}else p.name==="commandComplete"&&(o+=Ca(p),m===l.length-1?i.push({...s,affectedRows:o,...n?{blob:n}:{}}):i.push(s),s={rows:[],fields:[]})}),i.length===0&&i.push({rows:[],fields:[]}),i}function Ca(r){let e=r.text.split(" ");switch(e[0]){case"INSERT":return parseInt(e[2],10);case"UPDATE":case"DELETE":return parseInt(e[1],10);default:return 0}}function xt(r){let e=r.find(t=>t.name==="parameterDescription");return e?e.dataTypeIDs:[]}var Tt=typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string",Pt;async function pi(){if(Tt||Pt)return;let r=new URL("./postgres.wasm",w);Pt=fetch(r)}var ze;async function di(r,e){if(e||ze)return WebAssembly.instantiate(e||ze,r),{instance:await WebAssembly.instantiate(e||ze,r),module:e||ze};let t=new URL("./postgres.wasm",w);if(Tt){let i=await(await import("fs/promises")).readFile(t),{module:s,instance:o}=await WebAssembly.instantiate(i,r);return ze=s,{instance:o,module:s}}else{Pt||(Pt=fetch(t));let n=await Pt,{module:i,instance:s}=await WebAssembly.instantiateStreaming(n,r);return ze=i,{instance:s,module:i}}}async function mi(){let r=new URL("./postgres.data",w);return Tt?(await(await import("fs/promises")).readFile(r)).buffer:(await fetch(r)).arrayBuffer()}var fi=()=>{if(globalThis.crypto?.randomUUID)return globalThis.crypto.randomUUID();let r=new Uint8Array(16);if(globalThis.crypto?.getRandomValues)globalThis.crypto.getRandomValues(r);else for(let t=0;t<r.length;t++)r[t]=Math.floor(Math.random()*256);r[6]=r[6]&15|64,r[8]=r[8]&63|128;let e=[];return r.forEach(t=>{e.push(t.toString(16).padStart(2,"0"))}),e.slice(0,4).join("")+"-"+e.slice(4,6).join("")+"-"+e.slice(6,8).join("")+"-"+e.slice(8,10).join("")+"-"+e.slice(10).join("")};async function yi(r,e,t,n){if(!t||t.length===0)return e;n=n??r;let i;try{await r.execProtocol(v.parse({text:e}),{syncToFs:!1}),i=xt((await r.execProtocol(v.describe({type:"S"}),{syncToFs:!1})).map(([c])=>c))}finally{await r.execProtocol(v.sync(),{syncToFs:!1})}let s=e.replace(/\$([0-9]+)/g,(c,l)=>"%"+l+"L");return(await n.query(`SELECT format($1, ${t.map((c,l)=>`$${l+2}`).join(", ")}) as query`,[s,...t],{paramTypes:[St,...i]})).rows[0].query}d();d();var hi={part:"part",container:"container"};function Kt(r,e,...t){let n=r.length-1,i=t.length-1;if(i!==-1){if(i===0){r[n]=r[n]+t[0]+e;return}r[n]=r[n]+t[0],r.push(...t.slice(1,i)),r.push(t[i]+e)}}function Ua(r,...e){let t=[r[0]];t.raw=[r.raw[0]];let n=[];for(let i=0;i<e.length;i++){let s=e[i],o=i+1;if(s?._templateType===hi.part){Kt(t,r[o],s.str),Kt(t.raw,r.raw[o],s.str);continue}if(s?._templateType===hi.container){Kt(t,r[o],...s.strings),Kt(t.raw,r.raw[o],...s.strings.raw),n.push(...s.values);continue}t.push(r[o]),t.raw.push(r.raw[o]),n.push(s)}return{_templateType:"container",strings:t,values:n}}function Qr(r,...e){let{strings:t,values:n}=Ua(r,...e);return{query:[t[0],...n.flatMap((i,s)=>[`$${s+1}`,t[s+1]])].join(""),params:n}}var At,ce,P,ee,Xt,Te,$r,Jt=class{constructor(){y(this,P);this.serializers={...Hr};this.parsers={...jr};y(this,At,!1);y(this,ce,!1)}async _initArrayTypes(){if(a(this,At))return;f(this,At,!0);let e=await this.query(`
      SELECT b.oid, b.typarray
      FROM pg_catalog.pg_type a
      LEFT JOIN pg_catalog.pg_type b ON b.oid = a.typelem
      WHERE a.typcategory = 'A'
      GROUP BY b.oid, b.typarray
      ORDER BY b.oid
    `);for(let t of e.rows)this.serializers[t.typarray]=n=>$t(n,this.serializers[t.oid],t.typarray),this.parsers[t.typarray]=n=>qr(n,this.parsers[t.oid],t.typarray)}async query(e,t,n){return await this._checkReady(),await this._runExclusiveTransaction(async()=>await u(this,P,Xt).call(this,e,t,n))}async sql(e,...t){let{query:n,params:i}=Qr(e,...t);return await this.query(n,i)}async exec(e,t){return await this._checkReady(),await this._runExclusiveTransaction(async()=>await u(this,P,Te).call(this,e,t))}async transaction(e){return await this._checkReady(),await this._runExclusiveTransaction(async()=>{await u(this,P,Te).call(this,"BEGIN"),f(this,ce,!0);let t=!1,n=()=>{if(t)throw new Error("Transaction is closed")},i={query:async(s,o,c)=>(n(),await u(this,P,Xt).call(this,s,o,c)),sql:async(s,...o)=>{let{query:c,params:l}=Qr(s,...o);return await u(this,P,Xt).call(this,c,l)},exec:async(s,o)=>(n(),await u(this,P,Te).call(this,s,o)),rollback:async()=>{n(),await u(this,P,Te).call(this,"ROLLBACK"),t=!0},get closed(){return t}};try{let s=await e(i);return t||(t=!0,await u(this,P,Te).call(this,"COMMIT")),f(this,ce,!1),s}catch(s){throw t||await u(this,P,Te).call(this,"ROLLBACK"),f(this,ce,!1),s}})}};At=new WeakMap,ce=new WeakMap,P=new WeakSet,ee=async function(e,t={}){return await this.execProtocol(e,{...t,syncToFs:!1})},Xt=async function(e,t=[],n){return await this._runExclusiveQuery(async()=>{u(this,P,$r).call(this,"runQuery",e,t,n),await this._handleBlob(n?.blob);let i;try{let o=await u(this,P,ee).call(this,v.parse({text:e,types:n?.paramTypes}),n),c=xt((await u(this,P,ee).call(this,v.describe({type:"S"}),n)).map(([p])=>p)),l=t.map((p,m)=>{let g=c[m];if(p==null)return null;let x=this.serializers[g];return x?x(p):p.toString()});i=[...o,...await u(this,P,ee).call(this,v.bind({values:l}),n),...await u(this,P,ee).call(this,v.describe({type:"P"}),n),...await u(this,P,ee).call(this,v.execute({}),n)]}finally{await u(this,P,ee).call(this,v.sync(),n)}await this._cleanupBlob(),a(this,ce)||await this.syncToFs();let s=await this._getWrittenBlob();return Yt(i.map(([o])=>o),this.parsers,n,s)[0]})},Te=async function(e,t){return await this._runExclusiveQuery(async()=>{u(this,P,$r).call(this,"runExec",e,t),await this._handleBlob(t?.blob);let n;try{n=await u(this,P,ee).call(this,v.query(e),t)}finally{await u(this,P,ee).call(this,v.sync(),t)}this._cleanupBlob(),a(this,ce)||await this.syncToFs();let i=await this._getWrittenBlob();return Yt(n.map(([s])=>s),this.parsers,t,i)})},$r=function(...e){this.debug>0&&console.log(...e)};d();var gi=_(dr(),1);async function Yr(r){if(Tt){let e=await import("fs"),t=await import("zlib"),{Writable:n}=await import("stream"),{pipeline:i}=await import("stream/promises");if(!e.existsSync(r))throw new Error(`Extension bundle not found: ${r}`);let s=t.createGunzip(),o=[];return await i(e.createReadStream(r),s,new n({write(c,l,p){o.push(c),p()}})),new Blob(o)}else{let e=await fetch(r.toString());if(!e.ok||!e.body)return null;if(e.headers.get("Content-Encoding")==="gzip")return e.blob();{let t=new DecompressionStream("gzip");return new Response(e.body.pipeThrough(t)).blob()}}}async function bi(r,e){for(let t in r.pg_extensions){let n;try{n=await r.pg_extensions[t]}catch(i){console.error("Failed to fetch extension:",t,i);continue}if(n){let i=new Uint8Array(await n.arrayBuffer());La(r,t,i,e)}else console.error("Could not get binary data for extension:",t)}}function La(r,e,t,n){gi.default.untar(t).forEach(s=>{if(!s.name.startsWith(".")){let o=r.WASM_PREFIX+"/"+s.name;if(s.name.endsWith(".so")){let c=(...p)=>{n("pgfs:ext OK",o,p)},l=(...p)=>{n("pgfs:ext FAIL",o,p)};r.FS.createPreloadedFile(za(o),s.name.split("/").pop().slice(0,-3),s.data,!0,!0,c,l,!1)}else r.FS.writeFile(o,s.data)}})}function za(r){let e=r.lastIndexOf("/");return e>0?r.slice(0,e):r}ve();ye();var Ge,Ae,Ee,je,He,Zt,er,tr,qe,Ft,Dt,Ot,Fe,le,q,De,te,wi,Et,Xr=class Xr extends Jt{constructor(t={},n={}){super();y(this,te);y(this,Ge,!1);y(this,Ae,!1);y(this,Ee,!1);y(this,je,!1);y(this,He,!1);y(this,Zt,new re);y(this,er,new re);y(this,tr,new re);y(this,qe,!1);this.debug=0;y(this,Ft);y(this,Dt,[]);y(this,Ot,new Pe);y(this,Fe);y(this,le);y(this,q,new Map);y(this,De,new Set);typeof t=="string"?n={dataDir:t,...n}:n=t,this.dataDir=n.dataDir,n?.debug!==void 0&&(this.debug=n.debug),n?.relaxedDurability!==void 0&&f(this,He,n.relaxedDurability),f(this,Ft,n.extensions??{}),this.waitReady=u(this,te,wi).call(this,n??{})}static async create(t,n){let i=typeof t=="string"?{dataDir:t,...n??{}}:t??{},s=new Xr(i);return await s.waitReady,s}get Module(){return this.mod}get ready(){return a(this,Ge)&&!a(this,Ae)&&!a(this,Ee)}get closed(){return a(this,Ee)}async close(){await this._checkReady(),f(this,Ae,!0);for(let t of a(this,Dt))await t();try{await this.execProtocol(v.end()),this.mod._pg_shutdown()}catch(t){let n=t;if(!(n.name==="ExitStatus"&&n.status===0))throw t}await this.fs.close(this.mod.FS),f(this,Ee,!0),f(this,Ae,!1)}async[Symbol.asyncDispose](){await this.close()}async _handleBlob(t){f(this,Fe,t?await t.arrayBuffer():void 0)}async _cleanupBlob(){f(this,Fe,void 0)}async _getWrittenBlob(){if(!a(this,le))return;let t=new Blob(a(this,le));return f(this,le,void 0),t}async _checkReady(){if(a(this,Ae))throw new Error("PGlite is closing");if(a(this,Ee))throw new Error("PGlite is closed");a(this,Ge)||await this.waitReady}async execProtocolRaw(t,{syncToFs:n=!0}={}){let i=t.length,s=this.mod;s._interactive_write(i),s.HEAPU8.set(t,1),s._interactive_one();let o=i+2,c=o+s._interactive_read(),l=s.HEAPU8.subarray(o,c);return n&&await this.syncToFs(),l}async execProtocol(t,{syncToFs:n=!0,throwOnError:i=!0,onNotice:s}={}){let o=await this.execProtocolRaw(t,{syncToFs:n}),c=[];return a(this,Ot).parse(o,l=>{if(l instanceof oe){if(f(this,Ot,new Pe),i)throw l}else if(l instanceof xe)this.debug>0&&console.warn(l),s&&s(l);else if(l instanceof Se)switch(l.text){case"BEGIN":f(this,je,!0);break;case"COMMIT":case"ROLLBACK":f(this,je,!1);break}else if(l instanceof we){let p=a(this,q).get(l.channel);p&&p.forEach(m=>{queueMicrotask(()=>m(l.payload))}),a(this,De).forEach(m=>{queueMicrotask(()=>m(l.channel,l.payload))})}c.push([l,o])}),c}isInTransaction(){return a(this,je)}async syncToFs(){if(a(this,qe))return;f(this,qe,!0);let t=async()=>{await a(this,tr).runExclusive(async()=>{f(this,qe,!1),await this.fs.syncToFs(this.mod.FS,a(this,He))})};a(this,He)?t():await t()}async listen(t,n){return a(this,q).has(t)||a(this,q).set(t,new Set),a(this,q).get(t).add(n),await this.exec(`LISTEN "${t}"`),async()=>{await this.unlisten(t,n)}}async unlisten(t,n){n?(a(this,q).get(t)?.delete(n),a(this,q).get(t)?.size===0&&(await this.exec(`UNLISTEN "${t}"`),a(this,q).delete(t))):(await this.exec(`UNLISTEN "${t}"`),a(this,q).delete(t))}onNotification(t){return a(this,De).add(t),()=>{a(this,De).delete(t)}}offNotification(t){a(this,De).delete(t)}async dumpDataDir(t){let n=this.dataDir?.split("/").pop()??"pgdata";return this.fs.dumpTar(this.mod.FS,n,t)}_runExclusiveQuery(t){return a(this,Zt).runExclusive(t)}_runExclusiveTransaction(t){return a(this,er).runExclusive(t)}};Ge=new WeakMap,Ae=new WeakMap,Ee=new WeakMap,je=new WeakMap,He=new WeakMap,Zt=new WeakMap,er=new WeakMap,tr=new WeakMap,qe=new WeakMap,Ft=new WeakMap,Dt=new WeakMap,Ot=new WeakMap,Fe=new WeakMap,le=new WeakMap,q=new WeakMap,De=new WeakMap,te=new WeakSet,wi=async function(t){if(t.fs)this.fs=t.fs;else{let{dataDir:m,fsType:g}=Rn(t.dataDir);this.fs=await _n(m,g)}let n={},i=[],s=[`PGDATA=${B}`,`PREFIX=${zt}`,`PGUSER=${t.username??"postgres"}`,`PGDATABASE=${t.database??"template1"}`,"MODE=REACT","REPL=N",...this.debug?["-d",this.debug.toString()]:[]];t.wasmModule||pi();let o=t.fsBundle?t.fsBundle.arrayBuffer():mi(),c;o.then(m=>{c=m});let l={WASM_PREFIX:zt,arguments:s,INITIAL_MEMORY:t.initialMemory,noExitRuntime:!0,...this.debug>0?{print:console.info,printErr:console.error}:{print:()=>{},printErr:()=>{}},instantiateWasm:(m,g)=>(di(m,t.wasmModule).then(({instance:x,module:C})=>{g(x,C)}),{}),getPreloadedPackage:(m,g)=>{if(m==="postgres.data"){if(c.byteLength!==g)throw new Error(`Invalid FS bundle size: ${c.byteLength} !== ${g}`);return c}throw new Error(`Unknown package: ${m}`)},preRun:[m=>{let g=m.FS.makedev(64,0),x={open:C=>{},close:C=>{},read:(C,We,ue,pe,K)=>{let Jr=a(this,Fe);if(!Jr)throw new Error("No /dev/blob File or Blob provided to read from");let rr=new Uint8Array(Jr);if(K>=rr.length)return 0;let Zr=Math.min(rr.length-K,pe);for(let It=0;It<Zr;It++)We[ue+It]=rr[K+It];return Zr},write:(C,We,ue,pe,K)=>(a(this,le)??f(this,le,[]),a(this,le).push(We.slice(ue,ue+pe)),pe),llseek:(C,We,ue)=>{let pe=a(this,Fe);if(!pe)throw new Error("No /dev/blob File or Blob provided to llseek");let K=We;if(ue===1?K+=C.position:ue===2&&(K=new Uint8Array(pe).length),K<0)throw new m.FS.ErrnoError(28);return K}};m.FS.registerDevice(g,x),m.FS.mkdev("/dev/blob",g)}]};l=await this.fs.emscriptenOpts(l);for(let[m,g]of Object.entries(a(this,Ft)))if(g instanceof URL)n[m]=Yr(g);else{let x=await g.setup(this,l);if(x.emscriptenOpts&&(l=x.emscriptenOpts),x.namespaceObj){let C=this;C[m]=x.namespaceObj}x.bundlePath&&(n[m]=Yr(x.bundlePath)),x.init&&i.push(x.init),x.close&&a(this,Dt).push(x.close)}if(l.pg_extensions=n,await o,this.mod=await nn(l),await this.fs.initialSyncFs(this.mod.FS),t.loadDataDir){if(this.mod.FS.analyzePath(B+"/PG_VERSION").exists)throw new Error("Database already exists, cannot load from tarball");u(this,te,Et).call(this,"pglite: loading data from tarball"),await Tn(this.mod.FS,t.loadDataDir)}this.mod.FS.analyzePath(B+"/PG_VERSION").exists?u(this,te,Et).call(this,"pglite: found DB, resuming"):u(this,te,Et).call(this,"pglite: no db"),await bi(this.mod,(...m)=>u(this,te,Et).call(this,...m));let p=this.mod._pg_initdb();if(!p)throw new Error("INITDB failed to return value");if(p&1)throw new Error("INITDB failed");if(p&2){let m=t.username??"postgres",g=t.database??"template1";if(p&4){if(!(p&12))throw new Error("Invalid db/user combination")}else if(g!=="template1"&&m!=="postgres")throw new Error("INITDB created a new datadir, but an alternative db/user was requested")}await this.syncToFs(),f(this,Ge,!0),await this.exec("SET search_path TO public;"),await this._initArrayTypes();for(let m of i)await m()},Et=function(...t){this.debug>0&&console.log(...t)};var Kr=Xr;d();fr();mr();0&&(module.exports={IdbFs,MemoryFS,Mutex,PGlite,formatQuery,messages,parse,protocol,types,uuid});
//# sourceMappingURL=index.cjs.map