import{a as w,c as pr,i as u}from"./chunk-Y3AVQXKT.js";var C=w((Qr,f)=>{"use strict";u();var W=9007199254740991,Y=function(r){return r}();function mr(r){return r===Y}function X(r){return typeof r=="string"||Object.prototype.toString.call(r)=="[object String]"}function fr(r){return Object.prototype.toString.call(r)=="[object Date]"}function z(r){return r!==null&&typeof r=="object"}function I(r){return typeof r=="function"}function lr(r){return typeof r=="number"&&r>-1&&r%1==0&&r<=W}function dr(r){return Object.prototype.toString.call(r)=="[object Array]"}function K(r){return z(r)&&!I(r)&&lr(r.length)}function N(r){return Object.prototype.toString.call(r)=="[object ArrayBuffer]"}function yr(r,e){return Array.prototype.map.call(r,e)}function gr(r,e){var t=Y;return I(e)&&Array.prototype.every.call(r,function(n,o,a){var s=e(n,o,a);return s&&(t=n),!s}),t}function Tr(r){return Object.assign.apply(null,arguments)}function $(r){var e,t,n;if(X(r)){for(t=r.length,n=new Uint8Array(t),e=0;e<t;e++)n[e]=r.charCodeAt(e)&255;return n}return N(r)?new Uint8Array(r):z(r)&&N(r.buffer)?new Uint8Array(r.buffer):K(r)?new Uint8Array(r):z(r)&&I(r.toString)?$(r.toString()):new Uint8Array}f.exports.MAX_SAFE_INTEGER=W;f.exports.isUndefined=mr;f.exports.isString=X;f.exports.isObject=z;f.exports.isDateTime=fr;f.exports.isFunction=I;f.exports.isArray=dr;f.exports.isArrayLike=K;f.exports.isArrayBuffer=N;f.exports.map=yr;f.exports.find=gr;f.exports.extend=Tr;f.exports.toUint8Array=$});var b=w((re,Z)=>{"use strict";u();var G="\0";Z.exports={NULL_CHAR:G,TMAGIC:"ustar"+G+"00",OLDGNU_MAGIC:"ustar  "+G,REGTYPE:0,LNKTYPE:1,SYMTYPE:2,CHRTYPE:3,BLKTYPE:4,DIRTYPE:5,FIFOTYPE:6,CONTTYPE:7,TSUID:parseInt("4000",8),TSGID:parseInt("2000",8),TSVTX:parseInt("1000",8),TUREAD:parseInt("0400",8),TUWRITE:parseInt("0200",8),TUEXEC:parseInt("0100",8),TGREAD:parseInt("0040",8),TGWRITE:parseInt("0020",8),TGEXEC:parseInt("0010",8),TOREAD:parseInt("0004",8),TOWRITE:parseInt("0002",8),TOEXEC:parseInt("0001",8),TPERMALL:parseInt("0777",8),TPERMMASK:parseInt("0777",8)}});var j=w((te,l)=>{"use strict";u();var J=C(),p=b(),xr=512,H=p.TPERMALL,Q=0,V=0,_=[["name",100,0,function(r,e){return E(r[e[0]],e[1])},function(r,e,t){return h(r.slice(e,e+t[1]))}],["mode",8,100,function(r,e){var t=r[e[0]]||H;return t=t&p.TPERMMASK,U(t,e[1],H)},function(r,e,t){var n=x(r.slice(e,e+t[1]));return n&=p.TPERMMASK,n}],["uid",8,108,function(r,e){return U(r[e[0]],e[1],Q)},function(r,e,t){return x(r.slice(e,e+t[1]))}],["gid",8,116,function(r,e){return U(r[e[0]],e[1],V)},function(r,e,t){return x(r.slice(e,e+t[1]))}],["size",12,124,function(r,e){return U(r.data.length,e[1])},function(r,e,t){return x(r.slice(e,e+t[1]))}],["modifyTime",12,136,function(r,e){return M(r[e[0]],e[1])},function(r,e,t){return D(r.slice(e,e+t[1]))}],["checksum",8,148,function(r,e){return"        "},function(r,e,t){return x(r.slice(e,e+t[1]))}],["type",1,156,function(r,e){return""+(parseInt(r[e[0]],10)||0)%8},function(r,e,t){return(parseInt(String.fromCharCode(r[e]),10)||0)%8}],["linkName",100,157,function(r,e){return""},function(r,e,t){return h(r.slice(e,e+t[1]))}],["ustar",8,257,function(r,e){return p.TMAGIC},function(r,e,t){return Fr(h(r.slice(e,e+t[1]),!0))},function(r,e){return r[e[0]]==p.TMAGIC||r[e[0]]==p.OLDGNU_MAGIC}],["owner",32,265,function(r,e){return E(r[e[0]],e[1])},function(r,e,t){return h(r.slice(e,e+t[1]))}],["group",32,297,function(r,e){return E(r[e[0]],e[1])},function(r,e,t){return h(r.slice(e,e+t[1]))}],["majorNumber",8,329,function(r,e){return""},function(r,e,t){return x(r.slice(e,e+t[1]))}],["minorNumber",8,337,function(r,e){return""},function(r,e,t){return x(r.slice(e,e+t[1]))}],["prefix",131,345,function(r,e){return E(r[e[0]],e[1])},function(r,e,t){return h(r.slice(e,e+t[1]))}],["accessTime",12,476,function(r,e){return M(r[e[0]],e[1])},function(r,e,t){return D(r.slice(e,e+t[1]))}],["createTime",12,488,function(r,e){return M(r[e[0]],e[1])},function(r,e,t){return D(r.slice(e,e+t[1]))}]],rr=function(r){var e=r[r.length-1];return e[2]+e[1]}(_);function Fr(r){if(r.length==8){var e=r.split("");if(e[5]==p.NULL_CHAR)return(e[6]==" "||e[6]==p.NULL_CHAR)&&(e[6]="0"),(e[7]==" "||e[7]==p.NULL_CHAR)&&(e[7]="0"),e=e.join(""),e==p.TMAGIC?e:r;if(e[7]==p.NULL_CHAR)return e[5]==p.NULL_CHAR&&(e[5]=" "),e[6]==p.NULL_CHAR&&(e[6]=" "),e==p.OLDGNU_MAGIC?e:r}return r}function E(r,e){return e-=1,J.isUndefined(r)&&(r=""),r=(""+r).substr(0,e),r+p.NULL_CHAR}function U(r,e,t){for(t=parseInt(t)||0,e-=1,r=(parseInt(r)||t).toString(8).substr(-e,e);r.length<e;)r="0"+r;return r+p.NULL_CHAR}function M(r,e){if(J.isDateTime(r))r=Math.floor(1*r/1e3);else if(r=parseInt(r,10),isFinite(r)){if(r<=0)return""}else r=Math.floor(1*new Date/1e3);return U(r,e,0)}function h(r,e){var t=String.fromCharCode.apply(null,r);if(e)return t;var n=t.indexOf(p.NULL_CHAR);return n>=0?t.substr(0,n):t}function x(r){var e=String.fromCharCode.apply(null,r);return parseInt(e.replace(/^0+$/g,""),8)||0}function D(r){return r.length==0||r[0]==0?null:new Date(1e3*x(r))}function Ar(r,e,t){var n=parseInt(e,10)||0,o=Math.min(n+rr,r.length),a=0,s=0,i=0;t&&_.every(function(F){return F[0]=="checksum"?(s=n+F[2],i=s+F[1],!1):!0});for(var c=32,m=n;m<o;m++){var S=m>=s&&m<i?c:r[m];a=(a+S)%262144}return a}l.exports.recordSize=xr;l.exports.defaultFileMode=H;l.exports.defaultUid=Q;l.exports.defaultGid=V;l.exports.posixHeader=_;l.exports.effectiveHeaderSize=rr;l.exports.calculateChecksum=Ar;l.exports.formatTarString=E;l.exports.formatTarNumber=U;l.exports.formatTarDateTime=M;l.exports.parseTarString=h;l.exports.parseTarNumber=x;l.exports.parseTarDateTime=D});var ir=w((ie,nr)=>{"use strict";u();var hr=b(),k=C(),A=j();function er(r){return A.recordSize}function tr(r){return Math.ceil(r.data.length/A.recordSize)*A.recordSize}function Sr(r){var e=0;return r.forEach(function(t){e+=er(t)+tr(t)}),e+=A.recordSize*2,new Uint8Array(e)}function wr(r,e,t){t=parseInt(t)||0;var n=t;A.posixHeader.forEach(function(c){for(var m=c[3](e,c),S=m.length,F=0;F<S;F+=1)r[n+F]=m.charCodeAt(F)&255;n+=c[1]});var o=k.find(A.posixHeader,function(c){return c[0]=="checksum"});if(o){var a=A.calculateChecksum(r,t,!0),s=A.formatTarNumber(a,o[1]-2)+hr.NULL_CHAR+" ";n=t+o[2];for(var i=0;i<s.length;i+=1)r[n]=s.charCodeAt(i)&255,n++}return t+er(e)}function Pr(r,e,t){return t=parseInt(t,10)||0,r.set(e.data,t),t+tr(e)}function Ur(r){r=k.map(r,function(n){return k.extend({},n,{data:k.toUint8Array(n.data)})});var e=Sr(r),t=0;return r.forEach(function(n){t=wr(e,n,t),t=Pr(e,n,t)}),e}nr.exports.tar=Ur});var sr=w((se,or)=>{"use strict";u();var Cr=b(),q=C(),g=j(),br={extractData:!0,checkHeader:!0,checkChecksum:!0,checkFileSize:!0},Er={size:!0,checksum:!0,ustar:!0},B={unexpectedEndOfFile:"Unexpected end of file.",fileCorrupted:"File is corrupted.",checksumCheckFailed:"Checksum check failed."};function vr(r){return g.recordSize}function zr(r){return Math.ceil(r/g.recordSize)*g.recordSize}function Ir(r,e){for(var t=e,n=Math.min(r.length,e+g.recordSize*2),o=t;o<n;o++)if(r[o]!=0)return!1;return!0}function Mr(r,e,t){if(r.length-e<g.recordSize){if(t.checkFileSize)throw new Error(B.unexpectedEndOfFile);return null}e=parseInt(e)||0;var n={},o=e;if(g.posixHeader.forEach(function(i){n[i[0]]=i[4](r,o,i),o+=i[1]}),n.type!=0&&(n.size=0),t.checkHeader&&g.posixHeader.forEach(function(i){if(q.isFunction(i[5])&&!i[5](n,i)){var c=new Error(B.fileCorrupted);throw c.data={offset:e+i[2],field:i[0]},c}}),t.checkChecksum){var a=g.calculateChecksum(r,e,!0);if(a!=n.checksum){var s=new Error(B.checksumCheckFailed);throw s.data={offset:e,header:n,checksum:a},s}}return n}function Dr(r,e,t,n){return n.extractData?t.size<=0?new Uint8Array:r.slice(e,e+t.size):null}function kr(r,e){var t={};return g.posixHeader.forEach(function(n){var o=n[0];Er[o]||(t[o]=r[o])}),t.isOldGNUFormat=r.ustar==Cr.OLDGNU_MAGIC,e&&(t.data=e),t}function Or(r,e){e=q.extend({},br,e);for(var t=[],n=0,o=r.length;o-n>=g.recordSize;){r=q.toUint8Array(r);var a=Mr(r,n,e);if(!a)break;n+=vr(a);var s=Dr(r,n,a,e);if(t.push(kr(a,s)),n+=zr(a.size),Ir(r,n))break}return t}or.exports.untar=Or});var cr=w((ce,ar)=>{"use strict";u();var Lr=C(),Rr=b(),Nr=ir(),Gr=sr();Lr.extend(ar.exports,Nr,Gr,Rr)});u();var P=class{constructor(e){this.dataDir=e}async syncToFs(e,t){}async initialSyncFs(e){}async close(e){}};u();var T=pr(cr(),1);u();u();var O=class extends P{async emscriptenOpts(e){return{...e,preRun:[...e.preRun||[],n=>{let o=n.FS.filesystems.IDBFS;n.FS.mkdir("/pglite"),n.FS.mkdir(`/pglite/${this.dataDir}`),n.FS.mount(o,{},`/pglite/${this.dataDir}`),n.FS.symlink(`/pglite/${this.dataDir}`,v)}]}}initialSyncFs(e){return new Promise((t,n)=>{e.syncfs(!0,o=>{o?n(o):t()})})}syncToFs(e,t){return new Promise((n,o)=>{e.syncfs(!1,a=>{a?o(a):n()})})}async dumpTar(e,t,n){return L(e,t,n)}async close(e){let t=e.filesystems.IDBFS.dbs[this.dataDir];t&&t.close(),e.quit()}};u();var R=class extends P{async emscriptenOpts(e){return e}async dumpTar(e,t,n){return L(e,t,n)}async close(e){e.quit()}};var Hr="/tmp/pglite",v=Hr+"/base";function he(r){let e;if(r?.startsWith("file://")){if(r=r.slice(7),!r)throw new Error("Invalid dataDir, must be a valid path");e="nodefs"}else r?.startsWith("idb://")?(r=r.slice(6),e="idbfs"):r?.startsWith("opfs-ahp://")?(r=r.slice(11),e="opfs-ahp"):!r||r?.startsWith("memory://")?e="memoryfs":e="nodefs";return{dataDir:r,fsType:e}}async function Se(r,e){let t;if(r&&e==="nodefs"){let{NodeFS:n}=await import("./fs/nodefs.js");t=new n(r)}else if(r&&e==="idbfs")t=new O(r);else if(r&&e==="opfs-ahp"){let{OpfsAhpFS:n}=await import("./fs/opfs-ahp/index.js");t=new n(r)}else t=new R;return t}async function L(r,e,t="auto"){let n=Br(r,v),[o,a]=await qr(n,t),s=(e||"pgdata")+(a?".tar.gz":".tar"),i=a?"application/x-gzip":"application/x-tar";return typeof File<"u"?new File([o],s,{type:i}):new Blob([o],{type:i})}var _r=["application/x-gtar","application/x-tar+gzip","application/x-gzip","application/gzip"];async function Ce(r,e){let t=new Uint8Array(await e.arrayBuffer()),n=typeof File<"u"&&e instanceof File?e.name:void 0;(_r.includes(e.type)||n?.endsWith(".tgz")||n?.endsWith(".tar.gz"))&&(t=await Xr(t));let a=(0,T.untar)(t);for(let s of a){let i=v+s.name,c=i.split("/").slice(0,-1);for(let m=1;m<=c.length;m++){let S=c.slice(0,m).join("/");r.analyzePath(S).exists||r.mkdir(S)}s.type===T.REGTYPE?(r.writeFile(i,s.data),r.utime(i,ur(s.modifyTime),ur(s.modifyTime))):s.type===T.DIRTYPE&&r.mkdir(i)}}function jr(r,e){let t=[],n=o=>{r.readdir(o).forEach(s=>{if(s==="."||s==="..")return;let i=o+"/"+s,c=r.stat(i),m=r.isFile(c.mode)?r.readFile(i,{encoding:"binary"}):new Uint8Array(0);t.push({name:i.substring(e.length),mode:c.mode,size:c.size,type:r.isFile(c.mode)?T.REGTYPE:T.DIRTYPE,modifyTime:c.mtime,data:m}),r.isDir(c.mode)&&n(i)})};return n(e),t}function Br(r,e){let t=jr(r,e);return(0,T.tar)(t)}async function qr(r,e="auto"){if(e==="none")return[r,!1];if(typeof CompressionStream<"u")return[await Wr(r),!0];if(typeof process<"u"&&process.versions&&process.versions.node)return[await Yr(r),!0];if(e==="auto")return[r,!1];throw new Error("Compression not supported in this environment")}async function Wr(r){let e=new CompressionStream("gzip"),t=e.writable.getWriter(),n=e.readable.getReader();t.write(r),t.close();let o=[];for(;;){let{value:i,done:c}=await n.read();if(c)break;i&&o.push(i)}let a=new Uint8Array(o.reduce((i,c)=>i+c.length,0)),s=0;return o.forEach(i=>{a.set(i,s),s+=i.length}),a}async function Yr(r){let{promisify:e}=await import("util"),{gzip:t}=await import("zlib");return await e(t)(r)}async function Xr(r){if(typeof CompressionStream<"u")return await Kr(r);if(typeof process<"u"&&process.versions&&process.versions.node)return await $r(r);throw new Error("Unsupported environment for decompression")}async function Kr(r){let e=new DecompressionStream("gzip"),t=e.writable.getWriter(),n=e.readable.getReader();t.write(r),t.close();let o=[];for(;;){let{value:i,done:c}=await n.read();if(c)break;i&&o.push(i)}let a=new Uint8Array(o.reduce((i,c)=>i+c.length,0)),s=0;return o.forEach(i=>{a.set(i,s),s+=i.length}),a}async function $r(r){let{promisify:e}=await import("util"),{gunzip:t}=await import("zlib");return await e(t)(r)}function ur(r){return r?typeof r=="number"?r:Math.floor(r.getTime()/1e3):Math.floor(Date.now()/1e3)}export{P as a,cr as b,L as c,Ce as d,O as e,R as f,Hr as g,v as h,he as i,Se as j};
//# sourceMappingURL=chunk-SJVDOE3S.js.map